<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALR Chinelos | Oficial</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --whatsapp: #25d366; --dark: #0f0f0f; --bg: #f4f7f6; --gold: #d4af37; --pix: #32bcad; --red: #e74c3c; }
        body { font-family: 'Montserrat', sans-serif; background: var(--bg); margin: 0; padding-bottom: 120px; }
        header { background: var(--dark); color: white; text-align: center; padding: 20px; border-bottom: 5px solid var(--gold); }
        .container { max-width: 1100px; margin: 0 auto; padding: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; }
        .card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); padding: 15px; display: flex; flex-direction: column; position: relative; }
        .foto { width: 100%; height: 200px; text-align: center; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; }
        .foto img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .price { font-size: 22px; font-weight: 900; color: #333; margin: 10px 0; }
        label { font-size: 10px; font-weight: 700; color: #666; display: block; margin-top: 10px; text-transform: uppercase; }
        select { width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ddd; margin-top: 2px; }
        .btn-add { background: var(--dark); color: white; padding: 12px; border: none; width: 100%; font-weight: bold; border-radius: 8px; cursor: pointer; margin-top: auto; }
        
        #carrinho, #checkout { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 25px; border-radius: 20px 20px 0 0; box-shadow: 0 -5px 30px rgba(0,0,0,0.3); display: none; z-index: 1000; text-align: center; max-width: 500px; margin: auto; border-top: 4px solid var(--gold); }
        .fechar-janela { position: absolute; top: 15px; right: 15px; font-size: 20px; font-weight: bold; color: #999; cursor: pointer; border: none; background: none; }
        
        .btn-pix { background: var(--pix); color: white; padding: 15px; border: none; width: 100%; font-weight: 900; border-radius: 10px; cursor: pointer; font-size: 16px; margin-top: 5px; text-decoration: none; display: block; }
        .btn-whats { background: var(--whatsapp); color: white; padding: 15px; border: none; width: 100%; font-weight: 900; border-radius: 10px; cursor: pointer; font-size: 16px; margin-top: 10px; text-decoration: none; display: block; box-sizing: border-box; }
        .item-lista { display: flex; justify-content: space-between; align-items: center; font-size: 13px; background: #f8f8f8; padding: 8px; margin-bottom: 5px; border-radius: 5px; }
        .remover { color: var(--red); font-weight: bold; cursor: pointer; padding: 5px; font-size: 11px; }
        .btn-voltar { background: #eee; color: #333; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 10px; }
        #pix-string { font-size: 10px; word-break: break-all; background: #f4f4f4; padding: 10px; display: block; margin: 15px 0; border: 1px dashed #32bcad; font-family: monospace; }

        /* AJUSTE NO CAMPO DE CEP */
        .bloco-frete { background: #fdfdfd; padding: 15px; border-radius: 12px; margin: 10px 0; border: 2px solid #eee; text-align: left; }
        .linha-input { display: flex; gap: 8px; margin-top: 5px; }
        .linha-input input { flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #ccc; font-size: 16px; outline: none; }
        #resultado-frete { font-size: 13px; color: #27ae60; font-weight: bold; margin-top: 8px; }
    </style>
</head>
<body>

<header><h1>ALR CHINELOS</h1></header>

<div class="container">
    <div class="card">
        <div class="foto"><img src="https://i.postimg.cc/jjJsZPFL/1766957819963.png"></div>
        <h3>Tradicional</h3><div class="price">R$ 25,00</div>
        <label>Borracha:</label><select class="bor" id="b1"></select>
        <label>Correia:</label><select class="cor" id="c1"></select>
        <label>Tamanho:</label><select id="t1"><option>33/34</option><option>35/36</option><option>37/38</option><option>39/40</option><option>41/42</option></select>
        <button class="btn-add" onclick="add('Tradicional', 25, 'b1', 'c1', 't1')">ADICIONAR</button>
    </div>

    <div class="card">
        <div class="foto"><img src="https://i.postimg.cc/52gvfd4v/1766955677709-2.jpg"></div>
        <h3>Quadrado</h3><div class="price">R$ 40,00</div>
        <label>Borracha:</label><select class="bor" id="b2"></select>
        <label>Correia:</label><select class="cor" id="c2"></select>
        <label>Tamanho:</label><select id="t2"><option>37/38</option><option>39/40</option></select>
        <button class="btn-add" onclick="add('Quadrado', 40, 'b2', 'c2', 't2')">ADICIONAR</button>
    </div>

    <div class="card">
        <div class="foto"><img src="https://i.postimg.cc/6pz8ZrGc/1766959844299.png"></div>
        <h3>Slim</h3><div class="price">R$ 25,00</div>
        <label>Borracha:</label><select class="bor" id="b3"></select>
        <label>Correia:</label><select class="cor" id="c3"></select>
        <label>Tamanho:</label><select id="t3"><option>33/34</option><option>35/36</option><option>37/38</option><option>39/40</option></select>
        <button class="btn-add" onclick="add('Slim', 25, 'b3', 'c3', 't3')">ADICIONAR</button>
    </div>
</div>

<div id="carrinho">
    <button class="fechar-janela" onclick="fecharJanelas()">‚úï</button>
    <h3>Meu Pedido</h3>
    <div id="lista-itens" style="max-height: 120px; overflow-y: auto; text-align: left;"></div>
    
    <div class="bloco-frete">
        <label style="font-size: 11px; font-weight: 900; color: #444;">CALCULAR ENTREGA (CEP):</label>
        <div class="linha-input">
            <input type="text" id="cep-final" placeholder="Ex: 65000000">
            <button onclick="apiFrete()" style="background:var(--dark); color:white; border:none; padding:10px 15px; border-radius:8px; cursor:pointer; font-weight:bold;">OK</button>
        </div>
        <div id="resultado-frete"></div>
    </div>

    <p>Total Geral: <strong id="val-t" style="font-size: 22px;">R$ 0,00</strong></p>
    <button class="btn-pix" onclick="gerarPix()">FINALIZAR E PAGAR</button>
    <button class="btn-voltar" onclick="fecharJanelas()">+ Adicionar Produtos</button>
</div>

<div id="checkout">
    <button class="fechar-janela" onclick="fecharJanelas()">‚úï</button>
    <h3 style="color: var(--pix);">PIX GERADO!</h3>
    <code id="pix-string"></code>
    <button class="btn-pix" onclick="copiar()">COPIAR C√ìDIGO PIX</button>
    <a id="link-whatsapp" href="#" target="_blank" class="btn-whats">ENVIAR COMPROVANTE NO WHATS</a>
    <button class="btn-voltar" onclick="fecharJanelas()">Fechar</button>
</div>

<script>
    const borrachas = ["Azul (cima)/Preto(baixo)", "Branco (cima)/Cinza(baixo)", "Branco (cima)/Rosa(baixo)", "Azul Marinho (cima)/Preto(baixo)", "Bege", "Verde", "Branco", "Preto"];
    const correias = ["Preto", "Branco", "Verde", "Vermelho", "Rosa"];
    document.querySelectorAll('.bor').forEach(s => borrachas.forEach(i => s.add(new Option(i))));
    document.querySelectorAll('.cor').forEach(s => correias.forEach(i => s.add(new Option(i))));

    let itens = [];
    let freteGlobal = 0;

    function add(nome, preco, b, c, t) {
        itens.push({ nome, preco, bor: document.getElementById(b).value, cor: document.getElementById(c).value, tam: document.getElementById(t).value });
        desenhar();
    }

    function removerItem(i) {
        itens.splice(i, 1);
        if (itens.length === 0) { freteGlobal = 0; document.getElementById('resultado-frete').innerText = ""; fecharJanelas(); }
        desenhar();
    }

    async function apiFrete() {
        let v_cep = document.getElementById('cep-final').value.replace(/\D/g, ''); // Remove qualquer coisa que n√£o seja n√∫mero
        let info = document.getElementById('resultado-frete');
        
        if (v_cep.length < 8) { 
            alert("O CEP deve ter 8 n√∫meros. Voc√™ digitou apenas " + v_cep.length); 
            return; 
        }
        
        info.innerText = "Consultando CEP...";

        try {
            let r = await fetch(`https://viacep.com.br/ws/${v_cep}/json/`);
            let d = await r.json();
            
            if (d.erro) { 
                alert("CEP n√£o encontrado no sistema dos Correios!"); 
                freteGlobal = 0; 
                info.innerText = "";
            } else {
                let uf = d.uf;
                // Valores de Frete ALR
                if (uf === "SP") freteGlobal = 15;
                else if (["RJ", "MG", "ES", "PR", "SC", "RS"].includes(uf)) freteGlobal = 25;
                else freteGlobal = 40; // Maranh√£o e Resto do Brasil

                // Adicional por par extra
                if (itens.length > 1) freteGlobal += (itens.length - 1) * 3;
                
                info.innerHTML = `üìç ${d.localidade}/${d.uf}<br>Frete: R$ ${freteGlobal.toFixed(2).replace('.',',')}`;
            }
            desenhar();
        } catch (e) { 
            alert("Erro ao conectar no servidor de frete."); 
        }
    }

    function desenhar() {
        let totalProdutos = 0;
        let listaHtml = document.getElementById('lista-itens');
        listaHtml.innerHTML = "";
        itens.forEach((item, i) => {
            totalProdutos += item.preco;
            listaHtml.innerHTML += `<div class="item-lista"><span>${item.nome} (${item.tam})</span><span class="remover" onclick="removerItem(${i})">remover</span></div>`;
        });
        document.getElementById('val-t').innerText = "R$ " + (totalProdutos + freteGlobal).toFixed(2).replace('.', ',');
        document.getElementById('carrinho').style.display = 'block';
    }

    function fecharJanelas() {
        document.getElementById('carrinho').style.display = 'none';
        document.getElementById('checkout').style.display = 'none';
    }

    function f(id, v) { return id + v.length.toString().padStart(2, '0') + v; }
    function crc16(data) {
        let crc = 0xFFFF;
        for (let i = 0; i < data.length; i++) {
            crc ^= data.charCodeAt(i) << 8;
            for (let j = 0; j < 8; j++) {
                if ((crc & 0x8000) !== 0) crc = (crc << 1) ^ 0x1021;
                else crc <<= 1;
            }
        }
        return (crc & 0xFFFF).toString(16).toUpperCase().padStart(4, '0');
    }

    function gerarPix() {
        if (freteGlobal === 0) { 
            alert("Voc√™ precisa calcular o frete antes de pagar!"); 
            return; 
        }
        
        let sub = 0;
        let zap = "Novo Pedido ALR Chinelos:\n\n";
        itens.forEach(i => { sub += i.preco; zap += `‚Ä¢ ${i.nome} ${i.tam} (${i.bor}/${i.cor})\n`; });
        
        let totalFinal = (sub + freteGlobal).toFixed(2);
        zap += `\nSubtotal: R$ ${sub.toFixed(2)}\nFrete: R$ ${freteGlobal.toFixed(2)}\n*TOTAL PAGO: R$ ${totalFinal.replace('.',',')}*`;
        
        document.getElementById('link-whatsapp').href = `https://wa.me/5515996266774?text=${encodeURIComponent(zap)}`;
        
        let pix = "000201010212" + f("26", f("00", "BR.GOV.BCB.PIX") + f("01", "+5515996266774")) + "520400005303986" + f("54", totalFinal) + "5802BR" + f("59", "ALR CHINELOS") + f("60", "IBIUNA") + "62070503***6304";
        document.getElementById('pix-string').innerText = pix + crc16(pix);
        document.getElementById('carrinho').style.display = 'none';
        document.getElementById('checkout').style.display = 'block';
    }

    function copiar() {
        navigator.clipboard.writeText(document.getElementById('pix-string').innerText).then(() => alert("Copiado com sucesso!"));
    }
</script>
</body>
</html>
